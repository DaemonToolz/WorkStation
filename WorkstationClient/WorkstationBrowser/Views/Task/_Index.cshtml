@using WorkstationBrowser.SessionReference
@model IEnumerable<WorkstationBrowser.SessionReference.TaskModel>

@{
    
    Dictionary<String, bool> MyRights = ViewData["CurrentUserRights"] as Dictionary<String, bool>;
}

<table class="table">
    <tr>
        <th>
            Title
        </th>
        <th>
            Description
        </th>
        <th>
            Begin
        </th>
        <th>
            End
        </th>
    @{
        if (ViewData["AddSection"] != null)
        {
            <th>
                User
            </th>
        }
    }

        <th></th>
    </tr>
    

    @for (int i = 0; i < Model.Count(); ++i) {
        using (Html.BeginForm("_Index", "Task", FormMethod.Post))
        {
            <tr>
                <td>
                    @Html.HiddenFor(modelItem => Model.ElementAt(i).id)
                    @Html.DisplayFor(modelItem => Model.ElementAt(i).title)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => Model.ElementAt(i).description)
                </td>
                <td>
                    @Html.ValueFor(modelItem => Model.ElementAt(i).begin, "{0:dd/MM/yyyy}")
                </td>
                <td>
                    @Html.ValueFor(modelItem => Model.ElementAt(i).end, "{0:dd/MM/yyyy}")
                </td> 
                <td>
                    @if (ViewData["AddSection"] != null && Model.ElementAt(i).user_id != null) {
                        @Html.Raw(((UsersModel[]) ViewData["TeamMembers"]).Single(user => user.id == Model.ElementAt(i).user_id).username) 
                    }
                    @Html.HiddenFor(modelItem => Model.ElementAt(i).user_id)
                    @Html.HiddenFor(modelItem => Model.ElementAt(i).project_id)
                </td>
                @{
                    if (ViewData["AddSection"] != null && MyRights["CanEditTask"])
                    {

                    <td>
                        <button type="submit" id="del_task" class="btn btn-default" name="action" value="Delete">
                            <i class="glyphicon glyphicon-trash"></i>
                        </button>
                    </td>

                    }
                }
            </tr>
        }
    }
    
    @{
        if (ViewData["AddSection"] != null && MyRights["CanEditTask"]) {
            <tr>
                <td>
                    <a id="new_task" class="btn btn-default" >
                        <i class="glyphicon glyphicon-plus"></i>
                    </a>
                </td>

            </tr>
        }

    }


</table>

@{
    if (ViewData["AddSection"] != null && MyRights["CanEditTask"])
    {
        <div id="partial" style="display: none">
            @{ Html.RenderAction("_Create"); }
        </div>

        <script>
            document.getElementById("new_task").onclick = function() {
                $("#partial").show();
                $("#new_task").hide();
            }
        </script>
    }
}
